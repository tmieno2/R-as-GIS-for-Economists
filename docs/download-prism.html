<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>9.3 PRISM with prism | R as GIS for Economists</title>
  <meta name="description" content="This is a book for Economists who regularly use spatial datasets for their econometric work." />
  <meta name="generator" content="bookdown 0.25 and GitBook 2.6.7" />

  <meta property="og:title" content="9.3 PRISM with prism | R as GIS for Economists" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is a book for Economists who regularly use spatial datasets for their econometric work." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="9.3 PRISM with prism | R as GIS for Economists" />
  
  <meta name="twitter:description" content="This is a book for Economists who regularly use spatial datasets for their econometric work." />
  

<meta name="author" content="Taro Mieno" />


<meta name="date" content="2022-04-12" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="CropScapeR.html"/>
<link rel="next" href="daymet-with-daymetr-and-feddata.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.1.1/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.1.1/leaflet-providers-plugin.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.21/datatables.js"></script>
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R as GIS for Economists</a></li>

<li class="divider"></li>
<li><a href="index.html#welcome">Welcome<span></span></a></li>
<li><a href="preface.html#preface">Preface<span></span></a>
<ul>
<li><a href="why-r-as-gis-for-economists.html#why-r-as-gis-for-economists">Why R as GIS for Economists?<span></span></a>
<ul>
<li><a href="why-r-as-gis-for-economists.html#r-vs-python">R vs Python<span></span></a></li>
<li><a href="why-r-as-gis-for-economists.html#r-vs-arcgis-or-qgis">R vs ArcGIS or QGIS<span></span></a></li>
<li><a href="why-r-as-gis-for-economists.html#summary">Summary<span></span></a></li>
</ul></li>
<li><a href="how-is-this-book-different-from-other-online-books-and-resources.html#how-is-this-book-different-from-other-online-books-and-resources">How is this book different from other online books and resources?<span></span></a></li>
<li><a href="topics-covered-in-this-book.html#topics-covered-in-this-book">Topics covered in this book<span></span></a></li>
<li><a href="conventions-of-the-book-and-some-notes.html#conventions-of-the-book-and-some-notes">Conventions of the book and some notes<span></span></a>
<ul>
<li><a href="conventions-of-the-book-and-some-notes.html#texts-in-gray-boxes">Texts in gray boxes<span></span></a></li>
<li><a href="conventions-of-the-book-and-some-notes.html#colored-boxes">Colored Boxes<span></span></a></li>
<li><a href="conventions-of-the-book-and-some-notes.html#parentheses-around-codes">Parentheses around codes<span></span></a></li>
<li><a href="conventions-of-the-book-and-some-notes.html#footnotes">Footnotes<span></span></a></li>
</ul></li>
<li><a href="session-information.html#session-information">Session Information<span></span></a></li>
</ul></li>
<li class="part"><span><b>I Demonstration<span></span></b></span></li>
<li class="chapter" data-level="1" data-path="demo.html"><a href="demo.html"><i class="fa fa-check"></i><b>1</b> R as GIS: Demonstrations<span></span></a>
<ul>
<li><a href="before-you-start.html#before-you-start">Before you start<span></span></a>
<ul>
<li><a href="before-you-start.html#target-audience">Target Audience<span></span></a></li>
<li><a href="before-you-start.html#direction-for-replication">Direction for replication<span></span></a></li>
</ul></li>
<li class="chapter" data-level="1.1" data-path="Demo1.html"><a href="Demo1.html"><i class="fa fa-check"></i><b>1.1</b> Demonstration 1: The impact of groundwater pumping on depth to water table<span></span></a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="Demo1.html"><a href="Demo1.html#project-overview"><i class="fa fa-check"></i><b>1.1.1</b> Project Overview<span></span></a></li>
<li class="chapter" data-level="1.1.2" data-path="Demo1.html"><a href="Demo1.html#project-demonstration"><i class="fa fa-check"></i><b>1.1.2</b> Project Demonstration<span></span></a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="demonstration-2-precision-agriculture.html"><a href="demonstration-2-precision-agriculture.html"><i class="fa fa-check"></i><b>1.2</b> Demonstration 2: Precision Agriculture<span></span></a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="demonstration-2-precision-agriculture.html"><a href="demonstration-2-precision-agriculture.html#project-overview-1"><i class="fa fa-check"></i><b>1.2.1</b> Project Overview<span></span></a></li>
<li class="chapter" data-level="1.2.2" data-path="demonstration-2-precision-agriculture.html"><a href="demonstration-2-precision-agriculture.html#project-demonstration-1"><i class="fa fa-check"></i><b>1.2.2</b> Project Demonstration<span></span></a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="demo3.html"><a href="demo3.html"><i class="fa fa-check"></i><b>1.3</b> Demonstration 3: Land Use and Weather<span></span></a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="demo3.html"><a href="demo3.html#project-overview-2"><i class="fa fa-check"></i><b>1.3.1</b> Project Overview<span></span></a></li>
<li class="chapter" data-level="1.3.2" data-path="demo3.html"><a href="demo3.html#project-demonstration-2"><i class="fa fa-check"></i><b>1.3.2</b> Project Demonstration<span></span></a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="demo4.html"><a href="demo4.html"><i class="fa fa-check"></i><b>1.4</b> Demonstration 4: The Impact of Railroad Presence on Corn Planted Acreage<span></span></a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="demo4.html"><a href="demo4.html#project-overview-3"><i class="fa fa-check"></i><b>1.4.1</b> Project Overview<span></span></a></li>
<li class="chapter" data-level="1.4.2" data-path="demo4.html"><a href="demo4.html#project-demonstration-3"><i class="fa fa-check"></i><b>1.4.2</b> Project Demonstration<span></span></a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="demonstration-5-groundwater-use-for-agricultural-irrigation.html"><a href="demonstration-5-groundwater-use-for-agricultural-irrigation.html"><i class="fa fa-check"></i><b>1.5</b> Demonstration 5: Groundwater use for agricultural irrigation<span></span></a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="demonstration-5-groundwater-use-for-agricultural-irrigation.html"><a href="demonstration-5-groundwater-use-for-agricultural-irrigation.html#project-overview-4"><i class="fa fa-check"></i><b>1.5.1</b> Project Overview<span></span></a></li>
<li class="chapter" data-level="1.5.2" data-path="demonstration-5-groundwater-use-for-agricultural-irrigation.html"><a href="demonstration-5-groundwater-use-for-agricultural-irrigation.html#project-demonstration-4"><i class="fa fa-check"></i><b>1.5.2</b> Project Demonstration<span></span></a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Foundations<span></span></b></span></li>
<li class="chapter" data-level="2" data-path="vector-basics.html"><a href="vector-basics.html"><i class="fa fa-check"></i><b>2</b> Vector Data Handling with <code>sf</code><span></span></a>
<ul>
<li><a href="before-you-start-1.html#before-you-start-1">Before you start<span></span></a>
<ul>
<li><a href="before-you-start-1.html#sf-or-sp"><code>sf</code> or <code>sp</code>?<span></span></a></li>
<li><a href="before-you-start-1.html#direction-for-replication-1">Direction for replication<span></span></a></li>
</ul></li>
<li class="chapter" data-level="2.1" data-path="spatial-data-structure.html"><a href="spatial-data-structure.html"><i class="fa fa-check"></i><b>2.1</b> Spatial Data Structure<span></span></a></li>
<li class="chapter" data-level="2.2" data-path="simple-feature-geometry-simple-feature-geometry-list-column-and-simple-feature.html"><a href="simple-feature-geometry-simple-feature-geometry-list-column-and-simple-feature.html"><i class="fa fa-check"></i><b>2.2</b> Simple feature geometry, simple feature geometry list-column, and simple feature<span></span></a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="simple-feature-geometry-simple-feature-geometry-list-column-and-simple-feature.html"><a href="simple-feature-geometry-simple-feature-geometry-list-column-and-simple-feature.html#simple-feature-geometry-sfg"><i class="fa fa-check"></i><b>2.2.1</b> Simple feature geometry (<code>sfg</code>)<span></span></a></li>
<li class="chapter" data-level="2.2.2" data-path="simple-feature-geometry-simple-feature-geometry-list-column-and-simple-feature.html"><a href="simple-feature-geometry-simple-feature-geometry-list-column-and-simple-feature.html#create-simple-feature-geometry-list-column-sfc-and-simple-feature-sf-from-scratch"><i class="fa fa-check"></i><b>2.2.2</b> Create simple feature geometry list-column (<code>sfc</code>) and simple feature (<code>sf</code>) from scratch<span></span></a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="reading-and-writing-vector-data.html"><a href="reading-and-writing-vector-data.html"><i class="fa fa-check"></i><b>2.3</b> Reading and writing vector data<span></span></a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="reading-and-writing-vector-data.html"><a href="reading-and-writing-vector-data.html#reading-a-shapefile"><i class="fa fa-check"></i><b>2.3.1</b> Reading a shapefile<span></span></a></li>
<li class="chapter" data-level="2.3.2" data-path="reading-and-writing-vector-data.html"><a href="reading-and-writing-vector-data.html#writing-to-a-shapefile"><i class="fa fa-check"></i><b>2.3.2</b> Writing to a shapefile<span></span></a></li>
<li class="chapter" data-level="2.3.3" data-path="reading-and-writing-vector-data.html"><a href="reading-and-writing-vector-data.html#better-alternatives"><i class="fa fa-check"></i><b>2.3.3</b> Better alternatives<span></span></a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="projection-with-a-different-coordinate-reference-systems.html"><a href="projection-with-a-different-coordinate-reference-systems.html"><i class="fa fa-check"></i><b>2.4</b> Projection with a different Coordinate Reference Systems<span></span></a></li>
<li class="chapter" data-level="2.5" data-path="quick-and-interactive-view-of-an-sf-object.html"><a href="quick-and-interactive-view-of-an-sf-object.html"><i class="fa fa-check"></i><b>2.5</b> Quick and interactive view of an <code>sf</code> object<span></span></a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="quick-and-interactive-view-of-an-sf-object.html"><a href="quick-and-interactive-view-of-an-sf-object.html#quick-view"><i class="fa fa-check"></i><b>2.5.1</b> Quick view<span></span></a></li>
<li class="chapter" data-level="2.5.2" data-path="quick-and-interactive-view-of-an-sf-object.html"><a href="quick-and-interactive-view-of-an-sf-object.html#interactive-view"><i class="fa fa-check"></i><b>2.5.2</b> Interactive view<span></span></a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="turning-a-data.frame-of-points-into-an-sf.html"><a href="turning-a-data.frame-of-points-into-an-sf.html"><i class="fa fa-check"></i><b>2.6</b> Turning a data.frame of points into an <code>sf</code><span></span></a></li>
<li class="chapter" data-level="2.7" data-path="conv_sp.html"><a href="conv_sp.html"><i class="fa fa-check"></i><b>2.7</b> Conversion to and from sp objects<span></span></a></li>
<li class="chapter" data-level="2.8" data-path="non-spatial-transformation-of-sf.html"><a href="non-spatial-transformation-of-sf.html"><i class="fa fa-check"></i><b>2.8</b> Non-spatial transformation of <code>sf</code><span></span></a>
<ul>
<li class="chapter" data-level="2.8.1" data-path="non-spatial-transformation-of-sf.html"><a href="non-spatial-transformation-of-sf.html#using-dplyr"><i class="fa fa-check"></i><b>2.8.1</b> Using <code>dplyr</code><span></span></a></li>
<li class="chapter" data-level="2.8.2" data-path="non-spatial-transformation-of-sf.html"><a href="non-spatial-transformation-of-sf.html#using-data.table"><i class="fa fa-check"></i><b>2.8.2</b> Using <code>data.table</code><span></span></a></li>
</ul></li>
<li class="chapter" data-level="2.9" data-path="non-interactive-geometrical-operations.html"><a href="non-interactive-geometrical-operations.html"><i class="fa fa-check"></i><b>2.9</b> Non-interactive geometrical operations<span></span></a>
<ul>
<li class="chapter" data-level="2.9.1" data-path="non-interactive-geometrical-operations.html"><a href="non-interactive-geometrical-operations.html#st_buffer"><i class="fa fa-check"></i><b>2.9.1</b> st_buffer<span></span></a></li>
<li class="chapter" data-level="2.9.2" data-path="non-interactive-geometrical-operations.html"><a href="non-interactive-geometrical-operations.html#st_area"><i class="fa fa-check"></i><b>2.9.2</b> st_area<span></span></a></li>
<li class="chapter" data-level="2.9.3" data-path="non-interactive-geometrical-operations.html"><a href="non-interactive-geometrical-operations.html#st_centroid"><i class="fa fa-check"></i><b>2.9.3</b> st_centroid<span></span></a></li>
<li class="chapter" data-level="2.9.4" data-path="non-interactive-geometrical-operations.html"><a href="non-interactive-geometrical-operations.html#st_length"><i class="fa fa-check"></i><b>2.9.4</b> st_length<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="int-vv.html"><a href="int-vv.html"><i class="fa fa-check"></i><b>3</b> Spatial Interactions of Vector Data: Subsetting and Joining<span></span></a>
<ul>
<li><a href="before-you-start-2.html#before-you-start-2">Before you start<span></span></a>
<ul>
<li><a href="before-you-start-2.html#direction-for-replication-2">Direction for replication<span></span></a></li>
</ul></li>
<li class="chapter" data-level="3.1" data-path="topo.html"><a href="topo.html"><i class="fa fa-check"></i><b>3.1</b> Topological relations<span></span></a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="topo.html"><a href="topo.html#st_intersects"><i class="fa fa-check"></i><b>3.1.1</b> st_intersects()<span></span></a></li>
<li class="chapter" data-level="3.1.2" data-path="topo.html"><a href="topo.html#st_is_within_distance"><i class="fa fa-check"></i><b>3.1.2</b> st_is_within_distance()<span></span></a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="spatial-subsetting-or-flagging.html"><a href="spatial-subsetting-or-flagging.html"><i class="fa fa-check"></i><b>3.2</b> Spatial Subsetting (or Flagging)<span></span></a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="spatial-subsetting-or-flagging.html"><a href="spatial-subsetting-or-flagging.html#polygons-source-vs-polygons-target"><i class="fa fa-check"></i><b>3.2.1</b> polygons (source) vs polygons (target)<span></span></a></li>
<li class="chapter" data-level="3.2.2" data-path="spatial-subsetting-or-flagging.html"><a href="spatial-subsetting-or-flagging.html#points-source-vs-polygons-target"><i class="fa fa-check"></i><b>3.2.2</b> points (source) vs polygons (target)<span></span></a></li>
<li class="chapter" data-level="3.2.3" data-path="spatial-subsetting-or-flagging.html"><a href="spatial-subsetting-or-flagging.html#lines_polygons"><i class="fa fa-check"></i><b>3.2.3</b> lines (source) vs polygons (target)<span></span></a></li>
<li class="chapter" data-level="3.2.4" data-path="spatial-subsetting-or-flagging.html"><a href="spatial-subsetting-or-flagging.html#polygons_points"><i class="fa fa-check"></i><b>3.2.4</b> polygons (source) vs points (target)<span></span></a></li>
<li class="chapter" data-level="3.2.5" data-path="spatial-subsetting-or-flagging.html"><a href="spatial-subsetting-or-flagging.html#subsetting-to-a-geographic-extent-bounding-box"><i class="fa fa-check"></i><b>3.2.5</b> Subsetting to a geographic extent (bounding box)<span></span></a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="sp-join.html"><a href="sp-join.html"><i class="fa fa-check"></i><b>3.3</b> Spatial Join<span></span></a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="sp-join.html"><a href="sp-join.html#case-1-points-target-vs-polygons-source"><i class="fa fa-check"></i><b>3.3.1</b> Case 1: points (target) vs polygons (source)<span></span></a></li>
<li class="chapter" data-level="3.3.2" data-path="sp-join.html"><a href="sp-join.html#case-2-polygons-target-vs-points-source"><i class="fa fa-check"></i><b>3.3.2</b> Case 2: polygons (target) vs points (source)<span></span></a></li>
<li class="chapter" data-level="3.3.3" data-path="sp-join.html"><a href="sp-join.html#polygon-polygon"><i class="fa fa-check"></i><b>3.3.3</b> Case 3: polygons (target) vs polygons (source)<span></span></a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="spatial-intersection-cropping-join.html"><a href="spatial-intersection-cropping-join.html"><i class="fa fa-check"></i><b>3.4</b> Spatial Intersection (cropping join)<span></span></a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="spatial-intersection-cropping-join.html"><a href="spatial-intersection-cropping-join.html#st-intersection"><i class="fa fa-check"></i><b>3.4.1</b> <code>st_intersection()</code><span></span></a></li>
<li class="chapter" data-level="3.4.2" data-path="spatial-intersection-cropping-join.html"><a href="spatial-intersection-cropping-join.html#area-weighted-average"><i class="fa fa-check"></i><b>3.4.2</b> Area-weighted average<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="raster-basics.html"><a href="raster-basics.html"><i class="fa fa-check"></i><b>4</b> Raster Data Handling<span></span></a>
<ul>
<li><a href="before-you-start-3.html#before-you-start-3">Before you start<span></span></a>
<ul>
<li><a href="before-you-start-3.html#direction-for-replication-3">Direction for replication<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4.1" data-path="raster-data-object-classes.html"><a href="raster-data-object-classes.html"><i class="fa fa-check"></i><b>4.1</b> Raster data object classes<span></span></a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="raster-data-object-classes.html"><a href="raster-data-object-classes.html#raster-package-rasterlayer-rasterstack-and-rasterbrick"><i class="fa fa-check"></i><b>4.1.1</b> <code>raster</code> package: <code>RasterLayer</code>, <code>RasterStack</code>, and <code>RasterBrick</code><span></span></a></li>
<li class="chapter" data-level="4.1.2" data-path="raster-data-object-classes.html"><a href="raster-data-object-classes.html#terra-package-spatraster"><i class="fa fa-check"></i><b>4.1.2</b> <code>terra</code> package: <code>SpatRaster</code><span></span></a></li>
<li class="chapter" data-level="4.1.3" data-path="raster-data-object-classes.html"><a href="raster-data-object-classes.html#converting-a-spatraster-object-to-a-raster-object."><i class="fa fa-check"></i><b>4.1.3</b> Converting a <code>SpatRaster</code> object to a <code>Raster</code><span class="math inline">\(^*\)</span> object.<span></span></a></li>
<li class="chapter" data-level="4.1.4" data-path="raster-data-object-classes.html"><a href="raster-data-object-classes.html#vector-data-in-the-terra-package"><i class="fa fa-check"></i><b>4.1.4</b> Vector data in the <code>terra</code> package<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="read-and-write-a-raster-data-file.html"><a href="read-and-write-a-raster-data-file.html"><i class="fa fa-check"></i><b>4.2</b> Read and write a raster data file<span></span></a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="read-and-write-a-raster-data-file.html"><a href="read-and-write-a-raster-data-file.html#read-raster-files"><i class="fa fa-check"></i><b>4.2.1</b> Read raster file(s)<span></span></a></li>
<li class="chapter" data-level="4.2.2" data-path="read-and-write-a-raster-data-file.html"><a href="read-and-write-a-raster-data-file.html#write-raster-files"><i class="fa fa-check"></i><b>4.2.2</b> Write raster files<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="extract-information-from-raster-data-object.html"><a href="extract-information-from-raster-data-object.html"><i class="fa fa-check"></i><b>4.3</b> Extract information from raster data object<span></span></a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="extract-information-from-raster-data-object.html"><a href="extract-information-from-raster-data-object.html#get-crs"><i class="fa fa-check"></i><b>4.3.1</b> Get CRS<span></span></a></li>
<li class="chapter" data-level="4.3.2" data-path="extract-information-from-raster-data-object.html"><a href="extract-information-from-raster-data-object.html#subset"><i class="fa fa-check"></i><b>4.3.2</b> Subset<span></span></a></li>
<li class="chapter" data-level="4.3.3" data-path="extract-information-from-raster-data-object.html"><a href="extract-information-from-raster-data-object.html#get-cell-values"><i class="fa fa-check"></i><b>4.3.3</b> Get cell values<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="turning-a-raster-object-into-a-data.html"><a href="turning-a-raster-object-into-a-data.html"><i class="fa fa-check"></i><b>4.4</b> Turning a raster object into a <code>data.frame</code><span></span></a></li>
<li class="chapter" data-level="4.5" data-path="quick-visualization.html"><a href="quick-visualization.html"><i class="fa fa-check"></i><b>4.5</b> Quick visualization<span></span></a></li>
<li class="chapter" data-level="4.6" data-path="work-with-netcdf.html"><a href="work-with-netcdf.html"><i class="fa fa-check"></i><b>4.6</b> Working with netCDFs<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="int-RV.html"><a href="int-RV.html"><i class="fa fa-check"></i><b>5</b> Spatial Interactions of Vector and Raster Data<span></span></a>
<ul>
<li><a href="before-you-start-4.html#before-you-start-4">Before you start<span></span></a>
<ul>
<li><a href="before-you-start-4.html#direction-for-replication-4">Direction for replication<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5.1" data-path="raster-crop.html"><a href="raster-crop.html"><i class="fa fa-check"></i><b>5.1</b> Cropping to the Area of Interest<span></span></a></li>
<li class="chapter" data-level="5.2" data-path="extracting-values-from-raster-layers-for-vector-data.html"><a href="extracting-values-from-raster-layers-for-vector-data.html"><i class="fa fa-check"></i><b>5.2</b> Extracting Values from Raster Layers for Vector Data<span></span></a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="extracting-values-from-raster-layers-for-vector-data.html"><a href="extracting-values-from-raster-layers-for-vector-data.html#simple-visual-illustrations-of-raster-data-extraction"><i class="fa fa-check"></i><b>5.2.1</b> Simple visual illustrations of raster data extraction<span></span></a></li>
<li class="chapter" data-level="5.2.2" data-path="extracting-values-from-raster-layers-for-vector-data.html"><a href="extracting-values-from-raster-layers-for-vector-data.html#extracting-to-points"><i class="fa fa-check"></i><b>5.2.2</b> Extracting to Points<span></span></a></li>
<li class="chapter" data-level="5.2.3" data-path="extracting-values-from-raster-layers-for-vector-data.html"><a href="extracting-values-from-raster-layers-for-vector-data.html#extracting-to-polygons-terra-way"><i class="fa fa-check"></i><b>5.2.3</b> Extracting to Polygons (<code>terra</code> way)<span></span></a></li>
<li class="chapter" data-level="5.2.4" data-path="extracting-values-from-raster-layers-for-vector-data.html"><a href="extracting-values-from-raster-layers-for-vector-data.html#extracting-to-polygons-exactextractr-way"><i class="fa fa-check"></i><b>5.2.4</b> Extracting to Polygons (<code>exactextractr</code> way)<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="extract-speed.html"><a href="extract-speed.html"><i class="fa fa-check"></i><b>5.3</b> Extraction speed comparison<span></span></a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="extract-speed.html"><a href="extract-speed.html#points-terraextract-and-rasterextract"><i class="fa fa-check"></i><b>5.3.1</b> Points: <code>terra::extract()</code> and <code>raster::extract()</code><span></span></a></li>
<li class="chapter" data-level="5.3.2" data-path="extract-speed.html"><a href="extract-speed.html#polygons-exact_extract-terraextract-and-rasterextract"><i class="fa fa-check"></i><b>5.3.2</b> Polygons: <code>exact_extract()</code>, <code>terra::extract()</code>, and <code>raster::extract()</code><span></span></a></li>
<li class="chapter" data-level="5.3.3" data-path="extract-speed.html"><a href="extract-speed.html#single-layer-vs-multi-layer"><i class="fa fa-check"></i><b>5.3.3</b> Single-layer vs multi-layer<span></span></a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III (slightly) Advanced Topics<span></span></b></span></li>
<li class="chapter" data-level="6" data-path="EE.html"><a href="EE.html"><i class="fa fa-check"></i><b>6</b> Extraction Speed Considerations<span></span></a>
<ul>
<li><a href="before-you-start-5.html#before-you-start-5">Before you start<span></span></a>
<ul>
<li><a href="before-you-start-5.html#direction-for-replication-5">Direction for replication<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6.1" data-path="single-raster-layer.html"><a href="single-raster-layer.html"><i class="fa fa-check"></i><b>6.1</b> Single raster layer<span></span></a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="single-raster-layer.html"><a href="single-raster-layer.html#datasets"><i class="fa fa-check"></i><b>6.1.1</b> Datasets<span></span></a></li>
<li class="chapter" data-level="6.1.2" data-path="single-raster-layer.html"><a href="single-raster-layer.html#parallelization"><i class="fa fa-check"></i><b>6.1.2</b> Parallelization<span></span></a></li>
<li class="chapter" data-level="6.1.3" data-path="single-raster-layer.html"><a href="single-raster-layer.html#summary-1"><i class="fa fa-check"></i><b>6.1.3</b> Summary<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="many-multi-layer.html"><a href="many-multi-layer.html"><i class="fa fa-check"></i><b>6.2</b> Many multi-layer raster files<span></span></a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="many-multi-layer.html"><a href="many-multi-layer.html#datasets-1"><i class="fa fa-check"></i><b>6.2.1</b> Datasets<span></span></a></li>
<li class="chapter" data-level="6.2.2" data-path="many-multi-layer.html"><a href="many-multi-layer.html#non-par-ext-multi"><i class="fa fa-check"></i><b>6.2.2</b> Non-parallelized extraction<span></span></a></li>
<li class="chapter" data-level="6.2.3" data-path="many-multi-layer.html"><a href="many-multi-layer.html#approach-1-parallelize-over-polygons-and-do-regular-loop-over-year-month"><i class="fa fa-check"></i><b>6.2.3</b> Approach 1: parallelize over polygons and do regular loop over year-month<span></span></a></li>
<li class="chapter" data-level="6.2.4" data-path="many-multi-layer.html"><a href="many-multi-layer.html#approach-2-parallelize-over-the-temporal-dimension-year-month"><i class="fa fa-check"></i><b>6.2.4</b> Approach 2: parallelize over the temporal dimension (year-month)<span></span></a></li>
<li class="chapter" data-level="6.2.5" data-path="many-multi-layer.html"><a href="many-multi-layer.html#memory-consideration"><i class="fa fa-check"></i><b>6.2.5</b> Memory consideration<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="stars-basics.html"><a href="stars-basics.html"><i class="fa fa-check"></i><b>7</b> Spatiotemporal Raster Data Handling with <code>stars</code><span></span></a>
<ul>
<li><a href="before-you-start-6.html#before-you-start-6">Before you start<span></span></a>
<ul>
<li><a href="before-you-start-6.html#direction-for-replication-6">Direction for replication<span></span></a></li>
</ul></li>
<li class="chapter" data-level="7.1" data-path="stars-structure.html"><a href="stars-structure.html"><i class="fa fa-check"></i><b>7.1</b> Understanding the structure of a <code>stars</code> object<span></span></a></li>
<li class="chapter" data-level="7.2" data-path="some-basic-operations-on-stars-objects.html"><a href="some-basic-operations-on-stars-objects.html"><i class="fa fa-check"></i><b>7.2</b> Some basic operations on <code>stars</code> objects<span></span></a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="some-basic-operations-on-stars-objects.html"><a href="some-basic-operations-on-stars-objects.html#subset-a-stars-object-by-index"><i class="fa fa-check"></i><b>7.2.1</b> Subset a <code>stars</code> object by index<span></span></a></li>
<li class="chapter" data-level="7.2.2" data-path="some-basic-operations-on-stars-objects.html"><a href="some-basic-operations-on-stars-objects.html#set-attribute-names"><i class="fa fa-check"></i><b>7.2.2</b> Set attribute names<span></span></a></li>
<li class="chapter" data-level="7.2.3" data-path="some-basic-operations-on-stars-objects.html"><a href="some-basic-operations-on-stars-objects.html#get-the-coordinate-reference-system"><i class="fa fa-check"></i><b>7.2.3</b> Get the coordinate reference system<span></span></a></li>
<li class="chapter" data-level="7.2.4" data-path="some-basic-operations-on-stars-objects.html"><a href="some-basic-operations-on-stars-objects.html#get-the-dimension-characteristics-and-values"><i class="fa fa-check"></i><b>7.2.4</b> Get the dimension characteristics and values<span></span></a></li>
<li class="chapter" data-level="7.2.5" data-path="some-basic-operations-on-stars-objects.html"><a href="some-basic-operations-on-stars-objects.html#attributes-to-dimensions-and-vice-versa"><i class="fa fa-check"></i><b>7.2.5</b> Attributes to dimensions, and vice versa<span></span></a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="quick-visualization-for-exploration.html"><a href="quick-visualization-for-exploration.html"><i class="fa fa-check"></i><b>7.3</b> Quick visualization for exploration<span></span></a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="quick-visualization-for-exploration.html"><a href="quick-visualization-for-exploration.html#quick-static-map"><i class="fa fa-check"></i><b>7.3.1</b> quick static map<span></span></a></li>
<li class="chapter" data-level="7.3.2" data-path="quick-visualization-for-exploration.html"><a href="quick-visualization-for-exploration.html#interactive-map"><i class="fa fa-check"></i><b>7.3.2</b> interactive map<span></span></a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="read-write-stars.html"><a href="read-write-stars.html"><i class="fa fa-check"></i><b>7.4</b> Reading and writing raster data<span></span></a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="read-write-stars.html"><a href="read-write-stars.html#reading-raster-data"><i class="fa fa-check"></i><b>7.4.1</b> Reading raster data<span></span></a></li>
<li class="chapter" data-level="7.4.2" data-path="read-write-stars.html"><a href="read-write-stars.html#writing-a-stars-object-to-a-file"><i class="fa fa-check"></i><b>7.4.2</b> Writing a <code>stars</code> object to a file<span></span></a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="stars-set-time.html"><a href="stars-set-time.html"><i class="fa fa-check"></i><b>7.5</b> Setting the time dimension manually<span></span></a></li>
<li class="chapter" data-level="7.6" data-path="dplyr-op.html"><a href="dplyr-op.html"><i class="fa fa-check"></i><b>7.6</b> <code>dplyr</code>-like operations<span></span></a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="dplyr-op.html"><a href="dplyr-op.html#filter"><i class="fa fa-check"></i><b>7.6.1</b> <code>filter()</code><span></span></a></li>
<li class="chapter" data-level="7.6.2" data-path="dplyr-op.html"><a href="dplyr-op.html#select"><i class="fa fa-check"></i><b>7.6.2</b> <code>select()</code><span></span></a></li>
<li class="chapter" data-level="7.6.3" data-path="dplyr-op.html"><a href="dplyr-op.html#mutate"><i class="fa fa-check"></i><b>7.6.3</b> <code>mutate()</code><span></span></a></li>
<li class="chapter" data-level="7.6.4" data-path="dplyr-op.html"><a href="dplyr-op.html#pull"><i class="fa fa-check"></i><b>7.6.4</b> <code>pull()</code><span></span></a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="merging-stars-objects-using-c-and-st_mosaic.html"><a href="merging-stars-objects-using-c-and-st_mosaic.html"><i class="fa fa-check"></i><b>7.7</b> Merging <code>stars</code> objects using <code>c()</code> and <code>st_mosaic()</code><span></span></a>
<ul>
<li class="chapter" data-level="7.7.1" data-path="merging-stars-objects-using-c-and-st_mosaic.html"><a href="merging-stars-objects-using-c-and-st_mosaic.html#merging-stars-objects-along-the-third-dimension-band"><i class="fa fa-check"></i><b>7.7.1</b> Merging <code>stars</code> objects along the third dimension (band)<span></span></a></li>
<li class="chapter" data-level="7.7.2" data-path="merging-stars-objects-using-c-and-st_mosaic.html"><a href="merging-stars-objects-using-c-and-st_mosaic.html#merge-two"><i class="fa fa-check"></i><b>7.7.2</b> Merging <code>stars</code> objects of different attributes<span></span></a></li>
<li class="chapter" data-level="7.7.3" data-path="merging-stars-objects-using-c-and-st_mosaic.html"><a href="merging-stars-objects-using-c-and-st_mosaic.html#merging-stars-objects-of-different-spatial-extents"><i class="fa fa-check"></i><b>7.7.3</b> Merging <code>stars</code> objects of different spatial extents<span></span></a></li>
</ul></li>
<li class="chapter" data-level="7.8" data-path="convert-to-rb.html"><a href="convert-to-rb.html"><i class="fa fa-check"></i><b>7.8</b> Convert from and to <code>Raster</code><span class="math inline">\(^*\)</span> or <code>SpatRaster</code> objects<span></span></a></li>
</ul></li>
<li class="part"><span><b>IV Extensions<span></span></b></span></li>
<li class="chapter" data-level="8" data-path="create-maps.html"><a href="create-maps.html"><i class="fa fa-check"></i><b>8</b> Creating Maps using <code>ggplot2</code><span></span></a>
<ul>
<li><a href="before-you-start-7.html#before-you-start-7">Before you start<span></span></a>
<ul>
<li><a href="before-you-start-7.html#direction-for-replication-7">Direction for replication<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8.1" data-path="geom-sf.html"><a href="geom-sf.html"><i class="fa fa-check"></i><b>8.1</b> Creating maps from <code>sf</code> objects<span></span></a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="geom-sf.html"><a href="geom-sf.html#datasets-2"><i class="fa fa-check"></i><b>8.1.1</b> Datasets<span></span></a></li>
<li class="chapter" data-level="8.1.2" data-path="geom-sf.html"><a href="geom-sf.html#basic-usage-of-geom_sf"><i class="fa fa-check"></i><b>8.1.2</b> Basic usage of <code>geom_sf()</code><span></span></a></li>
<li class="chapter" data-level="8.1.3" data-path="geom-sf.html"><a href="geom-sf.html#specifying-the-aesthetics"><i class="fa fa-check"></i><b>8.1.3</b> Specifying the aesthetics<span></span></a></li>
<li class="chapter" data-level="8.1.4" data-path="geom-sf.html"><a href="geom-sf.html#plotting-multiple-spatial-objects-in-one-figure"><i class="fa fa-check"></i><b>8.1.4</b> Plotting multiple spatial objects in one figure<span></span></a></li>
<li class="chapter" data-level="8.1.5" data-path="geom-sf.html"><a href="geom-sf.html#crs"><i class="fa fa-check"></i><b>8.1.5</b> CRS<span></span></a></li>
<li class="chapter" data-level="8.1.6" data-path="geom-sf.html"><a href="geom-sf.html#faceting"><i class="fa fa-check"></i><b>8.1.6</b> Faceting<span></span></a></li>
<li class="chapter" data-level="8.1.7" data-path="geom-sf.html"><a href="geom-sf.html#adding-texts-labels-on-a-map"><i class="fa fa-check"></i><b>8.1.7</b> Adding texts (labels) on a map<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="geom-raster.html"><a href="geom-raster.html"><i class="fa fa-check"></i><b>8.2</b> Raster data visualization: <code>geom_raster()</code> and <code>geom_stars()</code><span></span></a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="geom-raster.html"><a href="geom-raster.html#visualize-raster-with-geom_raster"><i class="fa fa-check"></i><b>8.2.1</b> Visualize <code>Raster</code><span class="math inline">\(^*\)</span> with <code>geom_raster()</code><span></span></a></li>
<li class="chapter" data-level="8.2.2" data-path="geom-raster.html"><a href="geom-raster.html#visualize-stars-with-geom_raster"><i class="fa fa-check"></i><b>8.2.2</b> Visualize <code>stars</code> with <code>geom_raster()</code><span></span></a></li>
<li class="chapter" data-level="8.2.3" data-path="geom-raster.html"><a href="geom-raster.html#visualize-stars-with-geom_stars"><i class="fa fa-check"></i><b>8.2.3</b> Visualize <code>stars</code> with <code>geom_stars()</code><span></span></a></li>
<li class="chapter" data-level="8.2.4" data-path="geom-raster.html"><a href="geom-raster.html#adding-geom_sf-layers"><i class="fa fa-check"></i><b>8.2.4</b> adding <code>geom_sf()</code> layers<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="color-scale.html"><a href="color-scale.html"><i class="fa fa-check"></i><b>8.3</b> Color scale<span></span></a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="color-scale.html"><a href="color-scale.html#viridis-color-maps"><i class="fa fa-check"></i><b>8.3.1</b> Viridis color maps<span></span></a></li>
<li class="chapter" data-level="8.3.2" data-path="color-scale.html"><a href="color-scale.html#rcolorbrewer-scale__distiller-and-scale__brewer"><i class="fa fa-check"></i><b>8.3.2</b> <code>RColorBrewer</code>: <code>scale_*_distiller()</code> and <code>scale_*_brewer()</code><span></span></a></li>
<li class="chapter" data-level="8.3.3" data-path="color-scale.html"><a href="color-scale.html#colorspace-package"><i class="fa fa-check"></i><b>8.3.3</b> <code>colorspace</code> package<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="arranging-maps.html"><a href="arranging-maps.html"><i class="fa fa-check"></i><b>8.4</b> Arranging maps<span></span></a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="arranging-maps.html"><a href="arranging-maps.html#multiple-panels-of-figures-as-a-single-figure"><i class="fa fa-check"></i><b>8.4.1</b> Multiple panels of figures as a single figure<span></span></a></li>
<li class="chapter" data-level="8.4.2" data-path="arranging-maps.html"><a href="arranging-maps.html#a-map-in-a-map-inset"><i class="fa fa-check"></i><b>8.4.2</b> A map in a map: inset<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="fine-tune.html"><a href="fine-tune.html"><i class="fa fa-check"></i><b>8.5</b> Fine-tuning maps for publication<span></span></a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="fine-tune.html"><a href="fine-tune.html#theme"><i class="fa fa-check"></i><b>8.5.1</b> Setting the theme<span></span></a></li>
<li class="chapter" data-level="8.5.2" data-path="fine-tune.html"><a href="fine-tune.html#legend"><i class="fa fa-check"></i><b>8.5.2</b> Legend<span></span></a></li>
<li class="chapter" data-level="8.5.3" data-path="fine-tune.html"><a href="fine-tune.html#facet-strips"><i class="fa fa-check"></i><b>8.5.3</b> Facet strips<span></span></a></li>
<li class="chapter" data-level="8.5.4" data-path="fine-tune.html"><a href="fine-tune.html#north-arrow-and-scale-bar"><i class="fa fa-check"></i><b>8.5.4</b> North arrow and scale bar<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="ggsave.html"><a href="ggsave.html"><i class="fa fa-check"></i><b>8.6</b> Saving a <code>ggplot</code> object as an image<span></span></a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="download-data.html"><a href="download-data.html"><i class="fa fa-check"></i><b>9</b> Download and process spatial datasets from within R<span></span></a>
<ul>
<li><a href="before-you-start-8.html#before-you-start-8">Before you start<span></span></a>
<ul>
<li><a href="before-you-start-8.html#direction-for-replication-8">Direction for replication<span></span></a></li>
</ul></li>
<li class="chapter" data-level="9.1" data-path="nass-quick.html"><a href="nass-quick.html"><i class="fa fa-check"></i><b>9.1</b> USDA NASS QuickStat with <code>tidyUSDA</code><span></span></a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="nass-quick.html"><a href="nass-quick.html#look-for-parameter-values"><i class="fa fa-check"></i><b>9.1.1</b> Look for parameter values<span></span></a></li>
<li class="chapter" data-level="9.1.2" data-path="nass-quick.html"><a href="nass-quick.html#caveats"><i class="fa fa-check"></i><b>9.1.2</b> Caveats<span></span></a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="CropScapeR.html"><a href="CropScapeR.html"><i class="fa fa-check"></i><b>9.2</b> CDL with <code>CropScapeR</code><span></span></a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="CropScapeR.html"><a href="CropScapeR.html#getcdldata-download-the-cdl-data-as-raster-data"><i class="fa fa-check"></i><b>9.2.1</b> <code>GetCDLData</code>: Download the CDL data as raster data<span></span></a></li>
<li class="chapter" data-level="9.2.2" data-path="CropScapeR.html"><a href="CropScapeR.html#data-processing-after-downloading-data"><i class="fa fa-check"></i><b>9.2.2</b> Data processing after downloading data<span></span></a></li>
<li class="chapter" data-level="9.2.3" data-path="CropScapeR.html"><a href="CropScapeR.html#other-forms-of-cdl-data"><i class="fa fa-check"></i><b>9.2.3</b> Other forms of CDL data<span></span></a></li>
<li class="chapter" data-level="9.2.4" data-path="CropScapeR.html"><a href="CropScapeR.html#mac-problem"><i class="fa fa-check"></i><b>9.2.4</b> SSL certificate problem on Mac<span></span></a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="download-prism.html"><a href="download-prism.html"><i class="fa fa-check"></i><b>9.3</b> PRISM with <code>prism</code><span></span></a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="download-prism.html"><a href="download-prism.html#basics"><i class="fa fa-check"></i><b>9.3.1</b> Basics<span></span></a></li>
<li class="chapter" data-level="9.3.2" data-path="download-prism.html"><a href="download-prism.html#download-daily-prism-data-for-many-years-and-build-your-own-datasets"><i class="fa fa-check"></i><b>9.3.2</b> Download daily PRISM data for many years and build your own datasets<span></span></a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="daymet-with-daymetr-and-feddata.html"><a href="daymet-with-daymetr-and-feddata.html"><i class="fa fa-check"></i><b>9.4</b> Daymet with <code>daymetr</code> and <code>FedData</code><span></span></a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="daymet-with-daymetr-and-feddata.html"><a href="daymet-with-daymetr-and-feddata.html#for-points-data"><i class="fa fa-check"></i><b>9.4.1</b> For points data<span></span></a></li>
<li class="chapter" data-level="9.4.2" data-path="daymet-with-daymetr-and-feddata.html"><a href="daymet-with-daymetr-and-feddata.html#daymet-poly"><i class="fa fa-check"></i><b>9.4.2</b> For polygons data<span></span></a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="gridMET.html"><a href="gridMET.html"><i class="fa fa-check"></i><b>9.5</b> gridMET<span></span></a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="gridMET.html"><a href="gridMET.html#practical-examples"><i class="fa fa-check"></i><b>9.5.1</b> Practical Examples<span></span></a></li>
</ul></li>
</ul></li>
<li class="appendix"><span><b>Appendix<span></span></b></span></li>
<li class="chapter" data-level="A" data-path="par-comp.html"><a href="par-comp.html"><i class="fa fa-check"></i><b>A</b> Loop and Parallel Computing<span></span></a>
<ul>
<li><a href="before-you-start-9.html#before-you-start-9">Before you start<span></span></a>
<ul>
<li><a href="before-you-start-9.html#direction-for-replication-9">Direction for replication<span></span></a></li>
<li><a href="before-you-start-9.html#packages-to-install-and-load">Packages to install and load<span></span></a></li>
</ul></li>
<li class="chapter" data-level="A.1" data-path="repetitive-processes-and-looping.html"><a href="repetitive-processes-and-looping.html"><i class="fa fa-check"></i><b>A.1</b> Repetitive processes and looping<span></span></a>
<ul>
<li class="chapter" data-level="A.1.1" data-path="repetitive-processes-and-looping.html"><a href="repetitive-processes-and-looping.html#what-is-looping"><i class="fa fa-check"></i><b>A.1.1</b> What is looping?<span></span></a></li>
<li class="chapter" data-level="A.1.2" data-path="repetitive-processes-and-looping.html"><a href="repetitive-processes-and-looping.html#for-loop"><i class="fa fa-check"></i><b>A.1.2</b> For loop<span></span></a></li>
<li class="chapter" data-level="A.1.3" data-path="repetitive-processes-and-looping.html"><a href="repetitive-processes-and-looping.html#for-loop-using-the-lapply-function"><i class="fa fa-check"></i><b>A.1.3</b> For loop using the <code>lapply()</code> function<span></span></a></li>
<li class="chapter" data-level="A.1.4" data-path="repetitive-processes-and-looping.html"><a href="repetitive-processes-and-looping.html#looping-over-multiple-variables-using-lapply"><i class="fa fa-check"></i><b>A.1.4</b> Looping over multiple variables using lapply()<span></span></a></li>
<li class="chapter" data-level="A.1.5" data-path="repetitive-processes-and-looping.html"><a href="repetitive-processes-and-looping.html#do-you-really-need-to-loop"><i class="fa fa-check"></i><b>A.1.5</b> Do you really need to loop?<span></span></a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="parcomp.html"><a href="parcomp.html"><i class="fa fa-check"></i><b>A.2</b> Parallelization of embarrassingly parallel processes<span></span></a>
<ul>
<li class="chapter" data-level="A.2.1" data-path="parcomp.html"><a href="parcomp.html#mac-or-linux-users"><i class="fa fa-check"></i><b>A.2.1</b> Mac or Linux users<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="ggplot2-minimals.html"><a href="ggplot2-minimals.html"><i class="fa fa-check"></i><b>B</b> ggplot2 minimals<span></span></a></li>
<li><a href="references.html#references">References<span></span></a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R as GIS for Economists</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<link href="style.css" rel="stylesheet" type="text/css">

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-59758608-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-59758608-3');
</script>

<div id="download-prism" class="section level2 hasAnchor" number="9.3">
<h2><span class="header-section-number">9.3</span> PRISM with <code>prism</code><a href="download-prism.html#download-prism" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="basics" class="section level3 hasAnchor" number="9.3.1">
<h3><span class="header-section-number">9.3.1</span> Basics<a href="download-prism.html#basics" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><a href="https://prism.oregonstate.edu/">PRISM dataset</a> provide model-based estimates of precipitation, tmax, and tmin for the U.S. at the 4km by 4km spatial resolution. Here, we use <code>get_prism_dailys()</code> from the <code>prism</code> package <span class="citation">(<a href="#ref-prism" role="doc-biblioref">Hart and Bell 2015</a>)</span> to download daily data. Here is its general syntax:</p>
<div class="sourceCode" id="cb803"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb803-1"><a href="download-prism.html#cb803-1" aria-hidden="true" tabindex="-1"></a><span class="co">#--- NOT RUN ---#</span></span>
<span id="cb803-2"><a href="download-prism.html#cb803-2" aria-hidden="true" tabindex="-1"></a><span class="fu">get_prism_dailys</span>(</span>
<span id="cb803-3"><a href="download-prism.html#cb803-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> variable type,</span>
<span id="cb803-4"><a href="download-prism.html#cb803-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">minDate =</span> starting date as character,</span>
<span id="cb803-5"><a href="download-prism.html#cb803-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">maxDate =</span> ending date as character,</span>
<span id="cb803-6"><a href="download-prism.html#cb803-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">keepZip =</span> <span class="cn">TRUE</span> or <span class="cn">FALSE</span></span>
<span id="cb803-7"><a href="download-prism.html#cb803-7" aria-hidden="true" tabindex="-1"></a>) </span></code></pre></div>
<p>The variables types you can select from is ppt (precipitation), tmean (mean temperature), tmin (minimum temperature), and tmax (maximum temperature). For <code>minDate</code> and <code>maxDate</code>, the dates must be specified in a specific format of YYYY-MM-DD. <code>keepZip = FALSE</code> does not keep the zipped folders of the downloaded files as the name suggests.</p>
<p>Before you download PRISM data using the function, it is recommended that you set the path to folder in which the downloaded PRISM will be stored using <code>options(prism.path = "path")</code>. For example, the following set the path to Data/PRISM/ relative to the current working directory.</p>
<div class="sourceCode" id="cb804"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb804-1"><a href="download-prism.html#cb804-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">prism.path =</span> <span class="st">&quot;Data/PRISM/&quot;</span>)</span></code></pre></div>
<p>The following code downloads daily precipitation data from January 1, 2000 to Jan 10, 2000.</p>
<div class="sourceCode" id="cb805"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb805-1"><a href="download-prism.html#cb805-1" aria-hidden="true" tabindex="-1"></a><span class="co">#--- NOT RUN ---#</span></span>
<span id="cb805-2"><a href="download-prism.html#cb805-2" aria-hidden="true" tabindex="-1"></a><span class="fu">get_prism_dailys</span>(</span>
<span id="cb805-3"><a href="download-prism.html#cb805-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">&quot;ppt&quot;</span>,</span>
<span id="cb805-4"><a href="download-prism.html#cb805-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">minDate =</span> <span class="st">&quot;2000-01-01&quot;</span>,</span>
<span id="cb805-5"><a href="download-prism.html#cb805-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">maxDate =</span> <span class="st">&quot;2000-01-10&quot;</span>,</span>
<span id="cb805-6"><a href="download-prism.html#cb805-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">keepZip =</span> <span class="cn">FALSE</span></span>
<span id="cb805-7"><a href="download-prism.html#cb805-7" aria-hidden="true" tabindex="-1"></a>) </span></code></pre></div>
<p>When you download data using the above code, you will notice that it creates one folder for one day. For example, for precipitation data for 2000-01-01, you can get the path to the downloaded file as follows:</p>
<div class="sourceCode" id="cb806"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb806-1"><a href="download-prism.html#cb806-1" aria-hidden="true" tabindex="-1"></a>var_type <span class="ot">&lt;-</span> <span class="st">&quot;ppt&quot;</span> <span class="co"># variable type</span></span>
<span id="cb806-2"><a href="download-prism.html#cb806-2" aria-hidden="true" tabindex="-1"></a>dates_prism_txt <span class="ot">&lt;-</span> <span class="fu">str_remove_all</span>(<span class="st">&quot;2000-01-01&quot;</span>, <span class="st">&quot;-&quot;</span>) <span class="co"># date without dashes</span></span>
<span id="cb806-3"><a href="download-prism.html#cb806-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb806-4"><a href="download-prism.html#cb806-4" aria-hidden="true" tabindex="-1"></a><span class="co">#--- folder name ---#</span></span>
<span id="cb806-5"><a href="download-prism.html#cb806-5" aria-hidden="true" tabindex="-1"></a>folder_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;PRISM_&quot;</span>, var_type, <span class="st">&quot;_stable_4kmD2_&quot;</span>, dates_prism_txt, <span class="st">&quot;_bil&quot;</span>) </span>
<span id="cb806-6"><a href="download-prism.html#cb806-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb806-7"><a href="download-prism.html#cb806-7" aria-hidden="true" tabindex="-1"></a><span class="co">#--- file name of the downloaded data inside the above folder ---#</span></span>
<span id="cb806-8"><a href="download-prism.html#cb806-8" aria-hidden="true" tabindex="-1"></a>file_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;PRISM_&quot;</span>, var_type, <span class="st">&quot;_stable_4kmD2_&quot;</span>, dates_prism_txt, <span class="st">&quot;_bil.bil&quot;</span>) </span>
<span id="cb806-9"><a href="download-prism.html#cb806-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb806-10"><a href="download-prism.html#cb806-10" aria-hidden="true" tabindex="-1"></a><span class="co">#--- path to the file relative to the designated data folder (here, it&#39;s &quot;Data/PRISM/&quot;) ---#</span></span>
<span id="cb806-11"><a href="download-prism.html#cb806-11" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb806-12"><a href="download-prism.html#cb806-12" aria-hidden="true" tabindex="-1"></a>file_path <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;Data/PRISM/&quot;</span>, folder_name, <span class="st">&quot;/&quot;</span>, file_name)</span>
<span id="cb806-13"><a href="download-prism.html#cb806-13" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>[1] &quot;Data/PRISM/PRISM_ppt_stable_4kmD2_20000101_bil/PRISM_ppt_stable_4kmD2_20000101_bil.bil&quot;</code></pre>
<p>We can then easily read the data using <code>terra::rast()</code> or <code>stars::read_stars()</code> if you prefer the <code>stars</code> way.</p>
<div class="sourceCode" id="cb808"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb808-1"><a href="download-prism.html#cb808-1" aria-hidden="true" tabindex="-1"></a><span class="co">#--- as SpatRaster ---#</span></span>
<span id="cb808-2"><a href="download-prism.html#cb808-2" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb808-3"><a href="download-prism.html#cb808-3" aria-hidden="true" tabindex="-1"></a>prism_2000_01_01_sr <span class="ot">&lt;-</span> <span class="fu">rast</span>(file_path) </span>
<span id="cb808-4"><a href="download-prism.html#cb808-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>class       : SpatRaster 
dimensions  : 621, 1405, 1  (nrow, ncol, nlyr)
resolution  : 0.04166667, 0.04166667  (x, y)
extent      : -125.0208, -66.47917, 24.0625, 49.9375  (xmin, xmax, ymin, ymax)
coord. ref. : lon/lat NAD83 
source      : PRISM_ppt_stable_4kmD2_20000101_bil.bil 
name        : PRISM_ppt_stable_4kmD2_20000101_bil 
min value   :                                   0 
max value   :                              49.848 </code></pre>
<div class="sourceCode" id="cb810"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb810-1"><a href="download-prism.html#cb810-1" aria-hidden="true" tabindex="-1"></a><span class="co">#--- as stars ---#</span></span>
<span id="cb810-2"><a href="download-prism.html#cb810-2" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb810-3"><a href="download-prism.html#cb810-3" aria-hidden="true" tabindex="-1"></a>prism_2000_01_01_stars <span class="ot">&lt;-</span> <span class="fu">read_stars</span>(file_path) </span>
<span id="cb810-4"><a href="download-prism.html#cb810-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>stars object with 2 dimensions and 1 attribute
attribute(s):
                                   Min. 1st Qu. Median      Mean 3rd Qu.   Max.
PRISM_ppt_stable_4kmD2_2000010...     0       0      0 0.4952114       0 49.848
                                     NA&#39;s
PRISM_ppt_stable_4kmD2_2000010...  390874
dimension(s):
  from   to   offset      delta refsys point values x/y
x    1 1405 -125.021  0.0416667  NAD83    NA   NULL [x]
y    1  621  49.9375 -0.0416667  NAD83    NA   NULL [y]</code></pre>
<p>Here is a quick visualization of the data (Figure <a href="download-prism.html#fig:quick-viz">9.2</a>):</p>
<div class="sourceCode" id="cb812"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb812-1"><a href="download-prism.html#cb812-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(prism_2000_01_01_stars)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:quick-viz"></span>
<img src="R_GIS_Book_files/figure-html/quick-viz-1.png" alt="PRISM precipitation data for January 1, 2000" width="672" />
<p class="caption">
Figure 9.2: PRISM precipitation data for January 1, 2000
</p>
</div>
<p>As you can see, the data covers the entire contiguous U.S.</p>
</div>
<div id="download-daily-prism-data-for-many-years-and-build-your-own-datasets" class="section level3 hasAnchor" number="9.3.2">
<h3><span class="header-section-number">9.3.2</span> Download daily PRISM data for many years and build your own datasets<a href="download-prism.html#download-daily-prism-data-for-many-years-and-build-your-own-datasets" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Here, an example of how to create your own sets of PRISM datasets is presented. Creating such datasets and have them locally can be useful if you expect to use the data for many different projects in the future.</p>
<p>Suppose we are interested in saving daily PRISM precipitation data by year-month from 1980 to 2018. We will write a loop that loops over all the year-month combinations. Before writing a loop, lets work on the code for a particular year-month combination: 1990-December. However, we will write codes in a way that can be easily translated into a looped operations later. Specifically, we will define the following variables and use them as if they are variables to be looped over in a loop.</p>
<div class="sourceCode" id="cb813"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb813-1"><a href="download-prism.html#cb813-1" aria-hidden="true" tabindex="-1"></a><span class="co">#--- month to work on ---#  </span></span>
<span id="cb813-2"><a href="download-prism.html#cb813-2" aria-hidden="true" tabindex="-1"></a>temp_month <span class="ot">&lt;-</span> <span class="dv">12</span></span>
<span id="cb813-3"><a href="download-prism.html#cb813-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb813-4"><a href="download-prism.html#cb813-4" aria-hidden="true" tabindex="-1"></a><span class="co">#--- year to work on ---#  </span></span>
<span id="cb813-5"><a href="download-prism.html#cb813-5" aria-hidden="true" tabindex="-1"></a>temp_year <span class="ot">&lt;-</span> <span class="dv">1990</span></span></code></pre></div>
<p>We first need to set the path to the folder in which daily PRISM files will be downloaded.</p>
<div class="sourceCode" id="cb814"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb814-1"><a href="download-prism.html#cb814-1" aria-hidden="true" tabindex="-1"></a><span class="co">#--- set your own path ---#</span></span>
<span id="cb814-2"><a href="download-prism.html#cb814-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">prism.path =</span> <span class="st">&quot;Data/PRISM/&quot;</span>) </span></code></pre></div>
<p>We then set the start and end dates for <code>get_prism_dailys()</code>.</p>
<div class="sourceCode" id="cb815"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb815-1"><a href="download-prism.html#cb815-1" aria-hidden="true" tabindex="-1"></a><span class="co">#--- starting date of the working month-year ---#</span></span>
<span id="cb815-2"><a href="download-prism.html#cb815-2" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb815-3"><a href="download-prism.html#cb815-3" aria-hidden="true" tabindex="-1"></a>start_date <span class="ot">&lt;-</span> <span class="fu">dmy</span>(<span class="fu">paste0</span>(<span class="st">&quot;1/&quot;</span>, temp_month, <span class="st">&quot;/&quot;</span>, temp_year))</span>
<span id="cb815-4"><a href="download-prism.html#cb815-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>[1] &quot;1990-12-01&quot;</code></pre>
<div class="sourceCode" id="cb817"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb817-1"><a href="download-prism.html#cb817-1" aria-hidden="true" tabindex="-1"></a><span class="co">#--- ending date: add a month and then go back 1 day ---#</span></span>
<span id="cb817-2"><a href="download-prism.html#cb817-2" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb817-3"><a href="download-prism.html#cb817-3" aria-hidden="true" tabindex="-1"></a>end_date <span class="ot">&lt;-</span> start_date <span class="sc">%m+%</span> <span class="fu">months</span>(<span class="dv">1</span>) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb817-4"><a href="download-prism.html#cb817-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>[1] &quot;1990-12-31&quot;</code></pre>
<p>We now download PRISM data for the year-month we are working on.</p>
<div class="sourceCode" id="cb819"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb819-1"><a href="download-prism.html#cb819-1" aria-hidden="true" tabindex="-1"></a><span class="co">#--- download daily PRISM data for the working month-year ---#</span></span>
<span id="cb819-2"><a href="download-prism.html#cb819-2" aria-hidden="true" tabindex="-1"></a><span class="fu">get_prism_dailys</span>(</span>
<span id="cb819-3"><a href="download-prism.html#cb819-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">&quot;ppt&quot;</span>,</span>
<span id="cb819-4"><a href="download-prism.html#cb819-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">minDate =</span> <span class="fu">as.character</span>(start_date),</span>
<span id="cb819-5"><a href="download-prism.html#cb819-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">maxDate =</span> <span class="fu">as.character</span>(end_date),</span>
<span id="cb819-6"><a href="download-prism.html#cb819-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">keepZip =</span> <span class="cn">FALSE</span></span>
<span id="cb819-7"><a href="download-prism.html#cb819-7" aria-hidden="true" tabindex="-1"></a>) </span></code></pre></div>
<p>Once all the data are downloaded, we will read and import them onto R. To do so, we will need the path to all the downloaded files.</p>
<div class="sourceCode" id="cb820"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb820-1"><a href="download-prism.html#cb820-1" aria-hidden="true" tabindex="-1"></a><span class="co">#--- list of dates of the working month-year ---#</span></span>
<span id="cb820-2"><a href="download-prism.html#cb820-2" aria-hidden="true" tabindex="-1"></a>dates_ls <span class="ot">&lt;-</span> <span class="fu">seq</span>(start_date, end_date, <span class="st">&quot;days&quot;</span>) </span>
<span id="cb820-3"><a href="download-prism.html#cb820-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb820-4"><a href="download-prism.html#cb820-4" aria-hidden="true" tabindex="-1"></a><span class="co">#--- remove dashes ---#</span></span>
<span id="cb820-5"><a href="download-prism.html#cb820-5" aria-hidden="true" tabindex="-1"></a>dates_prism_txt <span class="ot">&lt;-</span> <span class="fu">str_remove_all</span>(dates_ls, <span class="st">&quot;-&quot;</span>)</span>
<span id="cb820-6"><a href="download-prism.html#cb820-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb820-7"><a href="download-prism.html#cb820-7" aria-hidden="true" tabindex="-1"></a><span class="co">#--- folder names ---#</span></span>
<span id="cb820-8"><a href="download-prism.html#cb820-8" aria-hidden="true" tabindex="-1"></a>folder_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;PRISM_&quot;</span>, var_type, <span class="st">&quot;_stable_4kmD2_&quot;</span>, dates_prism_txt, <span class="st">&quot;_bil&quot;</span>) </span>
<span id="cb820-9"><a href="download-prism.html#cb820-9" aria-hidden="true" tabindex="-1"></a><span class="co">#--- the file name of the downloaded data ---#</span></span>
<span id="cb820-10"><a href="download-prism.html#cb820-10" aria-hidden="true" tabindex="-1"></a>file_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;PRISM_&quot;</span>, var_type, <span class="st">&quot;_stable_4kmD2_&quot;</span>, dates_prism_txt, <span class="st">&quot;_bil.bil&quot;</span>) </span>
<span id="cb820-11"><a href="download-prism.html#cb820-11" aria-hidden="true" tabindex="-1"></a><span class="co">#--- complete path to the downloaded files ---#</span></span>
<span id="cb820-12"><a href="download-prism.html#cb820-12" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb820-13"><a href="download-prism.html#cb820-13" aria-hidden="true" tabindex="-1"></a>file_path <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;Data/PRISM/&quot;</span>, folder_name, <span class="st">&quot;/&quot;</span>, file_name) </span>
<span id="cb820-14"><a href="download-prism.html#cb820-14" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code> [1] &quot;Data/PRISM/PRISM_ppt_stable_4kmD2_19901201_bil/PRISM_ppt_stable_4kmD2_19901201_bil.bil&quot;
 [2] &quot;Data/PRISM/PRISM_ppt_stable_4kmD2_19901202_bil/PRISM_ppt_stable_4kmD2_19901202_bil.bil&quot;
 [3] &quot;Data/PRISM/PRISM_ppt_stable_4kmD2_19901203_bil/PRISM_ppt_stable_4kmD2_19901203_bil.bil&quot;
 [4] &quot;Data/PRISM/PRISM_ppt_stable_4kmD2_19901204_bil/PRISM_ppt_stable_4kmD2_19901204_bil.bil&quot;
 [5] &quot;Data/PRISM/PRISM_ppt_stable_4kmD2_19901205_bil/PRISM_ppt_stable_4kmD2_19901205_bil.bil&quot;
 [6] &quot;Data/PRISM/PRISM_ppt_stable_4kmD2_19901206_bil/PRISM_ppt_stable_4kmD2_19901206_bil.bil&quot;
 [7] &quot;Data/PRISM/PRISM_ppt_stable_4kmD2_19901207_bil/PRISM_ppt_stable_4kmD2_19901207_bil.bil&quot;
 [8] &quot;Data/PRISM/PRISM_ppt_stable_4kmD2_19901208_bil/PRISM_ppt_stable_4kmD2_19901208_bil.bil&quot;
 [9] &quot;Data/PRISM/PRISM_ppt_stable_4kmD2_19901209_bil/PRISM_ppt_stable_4kmD2_19901209_bil.bil&quot;
[10] &quot;Data/PRISM/PRISM_ppt_stable_4kmD2_19901210_bil/PRISM_ppt_stable_4kmD2_19901210_bil.bil&quot;
[11] &quot;Data/PRISM/PRISM_ppt_stable_4kmD2_19901211_bil/PRISM_ppt_stable_4kmD2_19901211_bil.bil&quot;
[12] &quot;Data/PRISM/PRISM_ppt_stable_4kmD2_19901212_bil/PRISM_ppt_stable_4kmD2_19901212_bil.bil&quot;
[13] &quot;Data/PRISM/PRISM_ppt_stable_4kmD2_19901213_bil/PRISM_ppt_stable_4kmD2_19901213_bil.bil&quot;
[14] &quot;Data/PRISM/PRISM_ppt_stable_4kmD2_19901214_bil/PRISM_ppt_stable_4kmD2_19901214_bil.bil&quot;
[15] &quot;Data/PRISM/PRISM_ppt_stable_4kmD2_19901215_bil/PRISM_ppt_stable_4kmD2_19901215_bil.bil&quot;
[16] &quot;Data/PRISM/PRISM_ppt_stable_4kmD2_19901216_bil/PRISM_ppt_stable_4kmD2_19901216_bil.bil&quot;
[17] &quot;Data/PRISM/PRISM_ppt_stable_4kmD2_19901217_bil/PRISM_ppt_stable_4kmD2_19901217_bil.bil&quot;
[18] &quot;Data/PRISM/PRISM_ppt_stable_4kmD2_19901218_bil/PRISM_ppt_stable_4kmD2_19901218_bil.bil&quot;
[19] &quot;Data/PRISM/PRISM_ppt_stable_4kmD2_19901219_bil/PRISM_ppt_stable_4kmD2_19901219_bil.bil&quot;
[20] &quot;Data/PRISM/PRISM_ppt_stable_4kmD2_19901220_bil/PRISM_ppt_stable_4kmD2_19901220_bil.bil&quot;
[21] &quot;Data/PRISM/PRISM_ppt_stable_4kmD2_19901221_bil/PRISM_ppt_stable_4kmD2_19901221_bil.bil&quot;
[22] &quot;Data/PRISM/PRISM_ppt_stable_4kmD2_19901222_bil/PRISM_ppt_stable_4kmD2_19901222_bil.bil&quot;
[23] &quot;Data/PRISM/PRISM_ppt_stable_4kmD2_19901223_bil/PRISM_ppt_stable_4kmD2_19901223_bil.bil&quot;
[24] &quot;Data/PRISM/PRISM_ppt_stable_4kmD2_19901224_bil/PRISM_ppt_stable_4kmD2_19901224_bil.bil&quot;
[25] &quot;Data/PRISM/PRISM_ppt_stable_4kmD2_19901225_bil/PRISM_ppt_stable_4kmD2_19901225_bil.bil&quot;
[26] &quot;Data/PRISM/PRISM_ppt_stable_4kmD2_19901226_bil/PRISM_ppt_stable_4kmD2_19901226_bil.bil&quot;
[27] &quot;Data/PRISM/PRISM_ppt_stable_4kmD2_19901227_bil/PRISM_ppt_stable_4kmD2_19901227_bil.bil&quot;
[28] &quot;Data/PRISM/PRISM_ppt_stable_4kmD2_19901228_bil/PRISM_ppt_stable_4kmD2_19901228_bil.bil&quot;
[29] &quot;Data/PRISM/PRISM_ppt_stable_4kmD2_19901229_bil/PRISM_ppt_stable_4kmD2_19901229_bil.bil&quot;
[30] &quot;Data/PRISM/PRISM_ppt_stable_4kmD2_19901230_bil/PRISM_ppt_stable_4kmD2_19901230_bil.bil&quot;
[31] &quot;Data/PRISM/PRISM_ppt_stable_4kmD2_19901231_bil/PRISM_ppt_stable_4kmD2_19901231_bil.bil&quot;</code></pre>
<p>We now read them as a <code>stars</code> object, set the third dimension as date using <code>Dates</code> object class, and then save it as an R dataset (This will ensure that date dimensions is kept. See Chapter <a href="read-write-stars.html#read-write-stars">7.4</a>).</p>
<div class="sourceCode" id="cb822"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb822-1"><a href="download-prism.html#cb822-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb822-2"><a href="download-prism.html#cb822-2" aria-hidden="true" tabindex="-1"></a><span class="co">#--- combine all the PRISM files as stars ---#</span></span>
<span id="cb822-3"><a href="download-prism.html#cb822-3" aria-hidden="true" tabindex="-1"></a>temp_stars <span class="ot">&lt;-</span> <span class="fu">read_stars</span>(file_path, <span class="at">along =</span> <span class="dv">3</span>)</span>
<span id="cb822-4"><a href="download-prism.html#cb822-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#--- set the third dimension as data ---# </span></span>
<span id="cb822-5"><a href="download-prism.html#cb822-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_set_dimensions</span>(<span class="st">&quot;band&quot;</span>, <span class="at">values =</span> dates_ls, <span class="at">name =</span> <span class="st">&quot;date&quot;</span>)</span>
<span id="cb822-6"><a href="download-prism.html#cb822-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb822-7"><a href="download-prism.html#cb822-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb822-8"><a href="download-prism.html#cb822-8" aria-hidden="true" tabindex="-1"></a><span class="co">#--- save the stars as an rds file ---#</span></span>
<span id="cb822-9"><a href="download-prism.html#cb822-9" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(</span>
<span id="cb822-10"><a href="download-prism.html#cb822-10" aria-hidden="true" tabindex="-1"></a>  temp_stars, </span>
<span id="cb822-11"><a href="download-prism.html#cb822-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(<span class="st">&quot;Data/PRISM/PRISM_&quot;</span>, var_type, <span class="st">&quot;_y&quot;</span>, temp_year, <span class="st">&quot;_m&quot;</span>, temp_month, <span class="st">&quot;.rds&quot;</span>)</span>
<span id="cb822-12"><a href="download-prism.html#cb822-12" aria-hidden="true" tabindex="-1"></a>)  </span></code></pre></div>
<p>You could alternatively read the files into a <code>SpatRaster</code> object and save it data as a GeoTIFF file.</p>
<div class="sourceCode" id="cb823"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb823-1"><a href="download-prism.html#cb823-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb823-2"><a href="download-prism.html#cb823-2" aria-hidden="true" tabindex="-1"></a><span class="co">#--- combine all the PRISM files as a RasterStack ---#</span></span>
<span id="cb823-3"><a href="download-prism.html#cb823-3" aria-hidden="true" tabindex="-1"></a>temp_stars <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(file_path) </span>
<span id="cb823-4"><a href="download-prism.html#cb823-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb823-5"><a href="download-prism.html#cb823-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb823-6"><a href="download-prism.html#cb823-6" aria-hidden="true" tabindex="-1"></a><span class="co">#--- save as a multi-band GeoTIFF file ---#</span></span>
<span id="cb823-7"><a href="download-prism.html#cb823-7" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(temp_stars, <span class="fu">paste0</span>(<span class="st">&quot;Data/PRISM/PRISM_&quot;</span>, var_type, <span class="st">&quot;_y&quot;</span>, temp_year, <span class="st">&quot;_m&quot;</span>, temp_month, <span class="st">&quot;.tif&quot;</span>), <span class="at">overwrite =</span> T) </span></code></pre></div>
<p>Note that this option of course does not have date as the third dimension. Moreover, the RDS file above takes up only 14 Mb, while the tif file occupies 108 Mb.</p>
<p>Finally, if you would like, you can delete all the individual PRISM files:</p>
<div class="sourceCode" id="cb824"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb824-1"><a href="download-prism.html#cb824-1" aria-hidden="true" tabindex="-1"></a><span class="co">#--- delete all the downloaded files ---#</span></span>
<span id="cb824-2"><a href="download-prism.html#cb824-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unlink</span>(<span class="fu">paste0</span>(<span class="st">&quot;Data/PRISM/&quot;</span>, folder_name), <span class="at">recursive =</span> <span class="cn">TRUE</span>) </span></code></pre></div>
<hr />
<p>Okay, now that we know what to do with a particular year-month combination, we can easily write a loop to go over all the year-month combinations for the period of interest. Since all the processes we observed above for a single year-month combination is embarrassingly parallel, it is easy to parallelize using <code>future.apply::future_lapply()</code> or <code>parallel::mclapply()</code> (Linux/Mac users only). Here we use <code>future_lapply()</code>. Lets first get the number of logical cores.</p>
<div class="sourceCode" id="cb825"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb825-1"><a href="download-prism.html#cb825-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(parallel)</span>
<span id="cb825-2"><a href="download-prism.html#cb825-2" aria-hidden="true" tabindex="-1"></a>num_cores <span class="ot">&lt;-</span> <span class="fu">detectCores</span>() </span>
<span id="cb825-3"><a href="download-prism.html#cb825-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb825-4"><a href="download-prism.html#cb825-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plan</span>(multiprocess, <span class="at">workers =</span> num_cores)</span></code></pre></div>
<p>The following function goes through all the steps we saw above for a single year-month combination.</p>
<div class="sourceCode" id="cb826"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb826-1"><a href="download-prism.html#cb826-1" aria-hidden="true" tabindex="-1"></a><span class="co">#--- define a function to download and save PRISM data stacked by month ---#</span></span>
<span id="cb826-2"><a href="download-prism.html#cb826-2" aria-hidden="true" tabindex="-1"></a>get_save_prism <span class="ot">&lt;-</span> <span class="cf">function</span>(i, var_type) {</span>
<span id="cb826-3"><a href="download-prism.html#cb826-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb826-4"><a href="download-prism.html#cb826-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">&quot;working on &quot;</span>, i))</span>
<span id="cb826-5"><a href="download-prism.html#cb826-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb826-6"><a href="download-prism.html#cb826-6" aria-hidden="true" tabindex="-1"></a>  temp_month <span class="ot">&lt;-</span> month_year_data[i, month] <span class="co"># working month</span></span>
<span id="cb826-7"><a href="download-prism.html#cb826-7" aria-hidden="true" tabindex="-1"></a>  temp_year <span class="ot">&lt;-</span> month_year_data[i, year] <span class="co"># working year</span></span>
<span id="cb826-8"><a href="download-prism.html#cb826-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb826-9"><a href="download-prism.html#cb826-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#--- starting date of the working month-year ---#</span></span>
<span id="cb826-10"><a href="download-prism.html#cb826-10" aria-hidden="true" tabindex="-1"></a>  start_date <span class="ot">&lt;-</span> <span class="fu">dmy</span>(<span class="fu">paste0</span>(<span class="st">&quot;1/&quot;</span>, temp_month, <span class="st">&quot;/&quot;</span>, temp_year))</span>
<span id="cb826-11"><a href="download-prism.html#cb826-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#--- end date ---#</span></span>
<span id="cb826-12"><a href="download-prism.html#cb826-12" aria-hidden="true" tabindex="-1"></a>  end_date <span class="ot">&lt;-</span> start_date <span class="sc">%m+%</span> <span class="fu">months</span>(<span class="dv">1</span>) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb826-13"><a href="download-prism.html#cb826-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb826-14"><a href="download-prism.html#cb826-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb826-15"><a href="download-prism.html#cb826-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">#--- download daily PRISM data for the working month-year ---#</span></span>
<span id="cb826-16"><a href="download-prism.html#cb826-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_prism_dailys</span>(</span>
<span id="cb826-17"><a href="download-prism.html#cb826-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> var_type,</span>
<span id="cb826-18"><a href="download-prism.html#cb826-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">minDate =</span> <span class="fu">as.character</span>(start_date),</span>
<span id="cb826-19"><a href="download-prism.html#cb826-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">maxDate =</span> <span class="fu">as.character</span>(end_date),</span>
<span id="cb826-20"><a href="download-prism.html#cb826-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">keepZip =</span> <span class="cn">FALSE</span></span>
<span id="cb826-21"><a href="download-prism.html#cb826-21" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb826-22"><a href="download-prism.html#cb826-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb826-23"><a href="download-prism.html#cb826-23" aria-hidden="true" tabindex="-1"></a>  <span class="co">#--- list of dates of the working month-year ---#</span></span>
<span id="cb826-24"><a href="download-prism.html#cb826-24" aria-hidden="true" tabindex="-1"></a>  dates_ls <span class="ot">&lt;-</span> <span class="fu">seq</span>(start_date, end_date, <span class="st">&quot;days&quot;</span>) </span>
<span id="cb826-25"><a href="download-prism.html#cb826-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb826-26"><a href="download-prism.html#cb826-26" aria-hidden="true" tabindex="-1"></a>  <span class="co">#--- remove dashes ---#</span></span>
<span id="cb826-27"><a href="download-prism.html#cb826-27" aria-hidden="true" tabindex="-1"></a>  dates_prism_txt <span class="ot">&lt;-</span> <span class="fu">str_remove_all</span>(dates_ls, <span class="st">&quot;-&quot;</span>)</span>
<span id="cb826-28"><a href="download-prism.html#cb826-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb826-29"><a href="download-prism.html#cb826-29" aria-hidden="true" tabindex="-1"></a>  <span class="co">#--- folder names ---#</span></span>
<span id="cb826-30"><a href="download-prism.html#cb826-30" aria-hidden="true" tabindex="-1"></a>  folder_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;PRISM_&quot;</span>, var_type, <span class="st">&quot;_stable_4kmD2_&quot;</span>, dates_prism_txt, <span class="st">&quot;_bil&quot;</span>) </span>
<span id="cb826-31"><a href="download-prism.html#cb826-31" aria-hidden="true" tabindex="-1"></a>  <span class="co">#--- the file name of the downloaded data ---#</span></span>
<span id="cb826-32"><a href="download-prism.html#cb826-32" aria-hidden="true" tabindex="-1"></a>  file_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;PRISM_&quot;</span>, var_type, <span class="st">&quot;_stable_4kmD2_&quot;</span>, dates_prism_txt, <span class="st">&quot;_bil.bil&quot;</span>) </span>
<span id="cb826-33"><a href="download-prism.html#cb826-33" aria-hidden="true" tabindex="-1"></a>  <span class="co">#--- complete path to the downloaded files ---#</span></span>
<span id="cb826-34"><a href="download-prism.html#cb826-34" aria-hidden="true" tabindex="-1"></a>  file_path <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;Data/PRISM/&quot;</span>, folder_name, <span class="st">&quot;/&quot;</span>, file_name)</span>
<span id="cb826-35"><a href="download-prism.html#cb826-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb826-36"><a href="download-prism.html#cb826-36" aria-hidden="true" tabindex="-1"></a>  <span class="co">#--- combine all the PRISM files as a RasterStack ---#</span></span>
<span id="cb826-37"><a href="download-prism.html#cb826-37" aria-hidden="true" tabindex="-1"></a>  temp_stars <span class="ot">&lt;-</span> <span class="fu">stack</span>(file_path) <span class="sc">%&gt;%</span> </span>
<span id="cb826-38"><a href="download-prism.html#cb826-38" aria-hidden="true" tabindex="-1"></a>    <span class="co">#--- convert to stars ---#</span></span>
<span id="cb826-39"><a href="download-prism.html#cb826-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_as_stars</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb826-40"><a href="download-prism.html#cb826-40" aria-hidden="true" tabindex="-1"></a>    <span class="co">#--- set the third dimension as data ---# </span></span>
<span id="cb826-41"><a href="download-prism.html#cb826-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_set_dimensions</span>(<span class="st">&quot;band&quot;</span>, <span class="at">values =</span> dates_ls, <span class="at">name =</span> <span class="st">&quot;date&quot;</span>)</span>
<span id="cb826-42"><a href="download-prism.html#cb826-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb826-43"><a href="download-prism.html#cb826-43" aria-hidden="true" tabindex="-1"></a>  <span class="co">#--- save the stars as an rds file ---#</span></span>
<span id="cb826-44"><a href="download-prism.html#cb826-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS</span>(</span>
<span id="cb826-45"><a href="download-prism.html#cb826-45" aria-hidden="true" tabindex="-1"></a>    temp_stars, </span>
<span id="cb826-46"><a href="download-prism.html#cb826-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste0</span>(<span class="st">&quot;Data/PRISM/PRISM_&quot;</span>, var_type, <span class="st">&quot;_y&quot;</span>, temp_year, <span class="st">&quot;_m&quot;</span>, temp_month, <span class="st">&quot;.rds&quot;</span>)</span>
<span id="cb826-47"><a href="download-prism.html#cb826-47" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb826-48"><a href="download-prism.html#cb826-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb826-49"><a href="download-prism.html#cb826-49" aria-hidden="true" tabindex="-1"></a>  <span class="co">#--- delete all the downloaded files ---#</span></span>
<span id="cb826-50"><a href="download-prism.html#cb826-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlink</span>(<span class="fu">paste0</span>(<span class="st">&quot;Data/PRISM/&quot;</span>, folder_name), <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb826-51"><a href="download-prism.html#cb826-51" aria-hidden="true" tabindex="-1"></a>} </span></code></pre></div>
<p>We then create a <code>data.frame</code> of all the year-month combinations:</p>
<div class="sourceCode" id="cb827"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb827-1"><a href="download-prism.html#cb827-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb827-2"><a href="download-prism.html#cb827-2" aria-hidden="true" tabindex="-1"></a><span class="co">#--- create a set of year-month combinations to loop over ---#</span></span>
<span id="cb827-3"><a href="download-prism.html#cb827-3" aria-hidden="true" tabindex="-1"></a>month_year_data <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">month  =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">year =</span> <span class="dv">1990</span><span class="sc">:</span><span class="dv">2018</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb827-4"><a href="download-prism.html#cb827-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.table</span>()</span>
<span id="cb827-5"><a href="download-prism.html#cb827-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>     month year
  1:     1 1990
  2:     2 1990
  3:     3 1990
  4:     4 1990
  5:     5 1990
 ---           
344:     8 2018
345:     9 2018
346:    10 2018
347:    11 2018
348:    12 2018</code></pre>
<p>We now do parallelized loop over all the year-month combinations (by looping over the rows of the <code>month_year_data</code>):</p>
<div class="sourceCode" id="cb829"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb829-1"><a href="download-prism.html#cb829-1" aria-hidden="true" tabindex="-1"></a><span class="co">#--- run the above code in parallel ---#</span></span>
<span id="cb829-2"><a href="download-prism.html#cb829-2" aria-hidden="true" tabindex="-1"></a><span class="fu">future_lapply</span>(</span>
<span id="cb829-3"><a href="download-prism.html#cb829-3" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(month_year_data), </span>
<span id="cb829-4"><a href="download-prism.html#cb829-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span> (x) <span class="fu">get_save_prism</span>(x, <span class="st">&quot;ppt&quot;</span>)</span>
<span id="cb829-5"><a href="download-prism.html#cb829-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Thats it. Of course, you can do the same thing for tmax by this:</p>
<div class="sourceCode" id="cb830"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb830-1"><a href="download-prism.html#cb830-1" aria-hidden="true" tabindex="-1"></a><span class="co">#--- run the above code in parallel ---#</span></span>
<span id="cb830-2"><a href="download-prism.html#cb830-2" aria-hidden="true" tabindex="-1"></a><span class="fu">future_lapply</span>(</span>
<span id="cb830-3"><a href="download-prism.html#cb830-3" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(month_year_data), </span>
<span id="cb830-4"><a href="download-prism.html#cb830-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span> (x) <span class="fu">get_save_prism</span>(x, <span class="st">&quot;tmax&quot;</span>)</span>
<span id="cb830-5"><a href="download-prism.html#cb830-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Now that you have PRISM datasets, you can extract values from the raster layers for vector data for your analysis, which is covered extensively in Chapters <a href="int-RV.html#int-RV">5</a> and <a href="stars-basics.html#stars-basics">7</a> (for <code>stars</code> objects).</p>
<hr />
<p>If you want to save the data by year (each file would be about 168 Mb). You could do this.</p>
<div class="sourceCode" id="cb831"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb831-1"><a href="download-prism.html#cb831-1" aria-hidden="true" tabindex="-1"></a><span class="co">#--- define a function to download and save PRISM data stacked by year ---#</span></span>
<span id="cb831-2"><a href="download-prism.html#cb831-2" aria-hidden="true" tabindex="-1"></a>get_save_prism_y <span class="ot">&lt;-</span> <span class="cf">function</span>(temp_year, var_type) {</span>
<span id="cb831-3"><a href="download-prism.html#cb831-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb831-4"><a href="download-prism.html#cb831-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">&quot;working on &quot;</span>, temp_year))</span>
<span id="cb831-5"><a href="download-prism.html#cb831-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb831-6"><a href="download-prism.html#cb831-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#--- starting date of the working month-year ---#</span></span>
<span id="cb831-7"><a href="download-prism.html#cb831-7" aria-hidden="true" tabindex="-1"></a>  start_date <span class="ot">&lt;-</span> <span class="fu">dmy</span>(<span class="fu">paste0</span>(<span class="st">&quot;1/1/&quot;</span>, temp_year))</span>
<span id="cb831-8"><a href="download-prism.html#cb831-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#--- end date ---#</span></span>
<span id="cb831-9"><a href="download-prism.html#cb831-9" aria-hidden="true" tabindex="-1"></a>  end_date <span class="ot">&lt;-</span> <span class="fu">dmy</span>(<span class="fu">paste0</span>(<span class="st">&quot;1/1/&quot;</span>, temp_year <span class="sc">+</span> <span class="dv">1</span>)) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb831-10"><a href="download-prism.html#cb831-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb831-11"><a href="download-prism.html#cb831-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#--- download daily PRISM data for the working month-year ---#</span></span>
<span id="cb831-12"><a href="download-prism.html#cb831-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_prism_dailys</span>(</span>
<span id="cb831-13"><a href="download-prism.html#cb831-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> var_type,</span>
<span id="cb831-14"><a href="download-prism.html#cb831-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">minDate =</span> <span class="fu">as.character</span>(start_date),</span>
<span id="cb831-15"><a href="download-prism.html#cb831-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">maxDate =</span> <span class="fu">as.character</span>(end_date),</span>
<span id="cb831-16"><a href="download-prism.html#cb831-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">keepZip =</span> <span class="cn">FALSE</span></span>
<span id="cb831-17"><a href="download-prism.html#cb831-17" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb831-18"><a href="download-prism.html#cb831-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb831-19"><a href="download-prism.html#cb831-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">#--- list of dates of the working month-year ---#</span></span>
<span id="cb831-20"><a href="download-prism.html#cb831-20" aria-hidden="true" tabindex="-1"></a>  dates_ls <span class="ot">&lt;-</span> <span class="fu">seq</span>(start_date, end_date, <span class="st">&quot;days&quot;</span>) </span>
<span id="cb831-21"><a href="download-prism.html#cb831-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb831-22"><a href="download-prism.html#cb831-22" aria-hidden="true" tabindex="-1"></a>  <span class="co">#--- remove dashes ---#</span></span>
<span id="cb831-23"><a href="download-prism.html#cb831-23" aria-hidden="true" tabindex="-1"></a>  dates_prism_txt <span class="ot">&lt;-</span> <span class="fu">str_remove_all</span>(dates_ls, <span class="st">&quot;-&quot;</span>)</span>
<span id="cb831-24"><a href="download-prism.html#cb831-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb831-25"><a href="download-prism.html#cb831-25" aria-hidden="true" tabindex="-1"></a>  <span class="co">#--- folder names ---#</span></span>
<span id="cb831-26"><a href="download-prism.html#cb831-26" aria-hidden="true" tabindex="-1"></a>  folder_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;PRISM_&quot;</span>, var_type, <span class="st">&quot;_stable_4kmD2_&quot;</span>, dates_prism_txt, <span class="st">&quot;_bil&quot;</span>) </span>
<span id="cb831-27"><a href="download-prism.html#cb831-27" aria-hidden="true" tabindex="-1"></a>  <span class="co">#--- the file name of the downloaded data ---#</span></span>
<span id="cb831-28"><a href="download-prism.html#cb831-28" aria-hidden="true" tabindex="-1"></a>  file_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;PRISM_&quot;</span>, var_type, <span class="st">&quot;_stable_4kmD2_&quot;</span>, dates_prism_txt, <span class="st">&quot;_bil.bil&quot;</span>) </span>
<span id="cb831-29"><a href="download-prism.html#cb831-29" aria-hidden="true" tabindex="-1"></a>  <span class="co">#--- complete path to the downloaded files ---#</span></span>
<span id="cb831-30"><a href="download-prism.html#cb831-30" aria-hidden="true" tabindex="-1"></a>  file_path <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;Data/PRISM/&quot;</span>, folder_name, <span class="st">&quot;/&quot;</span>, file_name)</span>
<span id="cb831-31"><a href="download-prism.html#cb831-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb831-32"><a href="download-prism.html#cb831-32" aria-hidden="true" tabindex="-1"></a>  <span class="co">#--- combine all the PRISM files as a RasterStack ---#</span></span>
<span id="cb831-33"><a href="download-prism.html#cb831-33" aria-hidden="true" tabindex="-1"></a>  temp_stars <span class="ot">&lt;-</span> <span class="fu">stack</span>(file_path) <span class="sc">%&gt;%</span> </span>
<span id="cb831-34"><a href="download-prism.html#cb831-34" aria-hidden="true" tabindex="-1"></a>    <span class="co">#--- convert to stars ---#</span></span>
<span id="cb831-35"><a href="download-prism.html#cb831-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_as_stars</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb831-36"><a href="download-prism.html#cb831-36" aria-hidden="true" tabindex="-1"></a>    <span class="co">#--- set the third dimension as data ---# </span></span>
<span id="cb831-37"><a href="download-prism.html#cb831-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_set_dimensions</span>(<span class="st">&quot;band&quot;</span>, <span class="at">values =</span> dates_ls, <span class="at">name =</span> <span class="st">&quot;date&quot;</span>)</span>
<span id="cb831-38"><a href="download-prism.html#cb831-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb831-39"><a href="download-prism.html#cb831-39" aria-hidden="true" tabindex="-1"></a>  <span class="co">#--- save the stars as an rds file ---#</span></span>
<span id="cb831-40"><a href="download-prism.html#cb831-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS</span>(</span>
<span id="cb831-41"><a href="download-prism.html#cb831-41" aria-hidden="true" tabindex="-1"></a>    temp_stars, </span>
<span id="cb831-42"><a href="download-prism.html#cb831-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste0</span>(<span class="st">&quot;Data/PRISM/PRISM_&quot;</span>, var_type, <span class="st">&quot;_y&quot;</span>, temp_year, <span class="st">&quot;.rds&quot;</span>)</span>
<span id="cb831-43"><a href="download-prism.html#cb831-43" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb831-44"><a href="download-prism.html#cb831-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb831-45"><a href="download-prism.html#cb831-45" aria-hidden="true" tabindex="-1"></a>  <span class="co">#--- delete all the downloaded files ---#</span></span>
<span id="cb831-46"><a href="download-prism.html#cb831-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlink</span>(<span class="fu">paste0</span>(<span class="st">&quot;Data/PRISM/&quot;</span>, folder_name), <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb831-47"><a href="download-prism.html#cb831-47" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb831-48"><a href="download-prism.html#cb831-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb831-49"><a href="download-prism.html#cb831-49" aria-hidden="true" tabindex="-1"></a><span class="co">#--- run the above code in parallel ---#</span></span>
<span id="cb831-50"><a href="download-prism.html#cb831-50" aria-hidden="true" tabindex="-1"></a><span class="fu">future_lapply</span>(</span>
<span id="cb831-51"><a href="download-prism.html#cb831-51" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1990</span><span class="sc">:</span><span class="dv">2018</span>, </span>
<span id="cb831-52"><a href="download-prism.html#cb831-52" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span> (x) <span class="fu">get_save_prism_y</span>(x, <span class="st">&quot;tmax&quot;</span>)</span>
<span id="cb831-53"><a href="download-prism.html#cb831-53" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
</div>
<h3>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-prism" class="csl-entry">
Hart, Edmund M., and Kendon Bell. 2015. <em>Prism: Download Data from the Oregon Prism Project</em>. <a href="https://doi.org/10.5281/zenodo.33663">https://doi.org/10.5281/zenodo.33663</a>.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="CropScapeR.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="daymet-with-daymetr-and-feddata.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection",
"toc_depth": 3,
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
